\documentclass[a4paper, 14pt, titlepage]{extarticle}
  \usepackage{cmap}
  \usepackage[utf8]{inputenc}
  \usepackage[english,russian]{babel}
  \usepackage{indentfirst}
  \usepackage{cite}
  \usepackage{amsmath} % для \eqref
  \usepackage{color} % пока только для TODO
  \frenchspacing

  \addto\captionsrussian{
    \renewcommand\contentsname{Содержание}
  }

  \newcommand{\underscore}[1]{\hbox to#1{\hrulefill}}
  \newcommand{\todo}[1]{\textbf{\textcolor{red}{TODO: #1}}}

  \newcommand{\vect}[1]{\vec{#1}}
  \newcommand{\matrx}[1]{\mathbf{#1}}

  % поля и размер текста
  \textwidth=17cm
  \oddsidemargin=0pt
  \topmargin=0pt
  \headheight=0pt
  \headsep=0pt
  \textheight=24cm
  \linespread{1.3}

  \renewcommand{\theenumii}{(\asbuk{enumii})}
  \renewcommand{\labelenumii}{\asbuk{enumii})}

  \bibliographystyle{gost780u}

  \author{И.\,А.\,Новиков, кафедра АФТИ ФФ НГУ, гр.\,7305}
  \title{Система моделирования деформаций неупругих тел в реальном времени}

\begin{document}

%----------------------- титульный лист ------------------------

  \thispagestyle{empty} 
  \begin {center} 
  МИНИСТЕРСТВО ОБРАЗОВАНИЯ И НАУКИ РОССИЙСКОЙ ФЕДЕРАЦИИ 

  \vspace{0.3cm} 

  Новосибирский государственный университет 

  \vspace{0.3cm} 

  Физический факультет 

  Кафедра автоматизации физико-технических исследований

  \vspace {5cm} 

  Февральский отчёт 

  \vspace {1cm} 

  Новиков Иван Александрович

  \vspace {0.5cm} 

  \textbf{СИСТЕМА МОДЕЛИРОВАНИЯ ДЕФОРМАЦИЙ НЕУПРУГИХ ТЕЛ В РЕАЛЬНОМ ВРЕМЕНИ} 

  \vspace {2cm} 

  \begin{flushright} 

    Научный руководитель 

    Д.\,А.\,Гладкий

  \end{flushright}

  \vspace {5cm} 

  Новосибирск, 2011~г.
  \end {center} 

%------------------------- содержание -------------------------

  \tableofcontents
  \newpage

%-------------------------- введение --------------------------
  \section{Введение}

    Приложения виртуальной реальности становятся чрезвычайно рас\-прос\-тра\-нён\-ны\-ми в~наши~дни.  Два
    основных их типа~--- это компьютерные игры и~обучающие симуляторы (тренажёры). Несмотря на
    различные применения, эти два типа приложений имеют много общего, поскольку в~обоих случаях
    требуется создать иллюзию присутствия у~пользователя. Для~этого необходимо как генерировать
    фотореалистичные изображения, так и правдоподобно моделировать физику взаимодействия объектов
    виртуального мира: их движение, столкновения, деформации и~разрушение.

    Моделирование деформаций объектов является актуальной задачей, поскольку помимо приложений
    виртуальной реальности оно находит применение в~системах автоматизированного проектирования, а~также используется
    при~создании спецэффектов к~фильмам.  Как правило, в зависимости от конкретного применения
    используются различные алгоритмы, поскольку ставятся разные задачи и в каждом случае имеют место
    специфические ограничения. А~именно, в~системах автоматизированного проектирования требуется
    максимальная точность расчётов, в~то~время как в~фильмах и приложениях виртуальной реальности
    требуется лишь визуальная правдоподобность. При~этом, если расчёты для САПР и~спецэффектов могут
    выполняться длительное время, то в~интерактивных приложениях расчёт одного шага вычислений должен
    происходить не~дольше, чем за~промежуток между кадрами, чтобы обеспечивать плавную анимацию
    и~быструю реакцию на~действия пользователя.

    Жёсткое требование быстродействия в приложениях реального времени не~только вынуждает
    использовать упрощённые физические модели деформации тела, менее точные, чем используемые
    в~инженерных расчётах, но и накладывают существенные ограничения на способ представления
    моделируемого объекта. Объект чаще всего задаётся в~дискретном виде: в~виде сетки, решётки или
    несвязанного набора точек, причём время расчётов напрямую (как~правило, линейно
    \cite{mueller-meshless}) зависит от количества точек в таком представлении. Для отображения
    объектов обычно используют высоко детализированные сетки, содержащие вплоть до нескольких
    сотен тысяч и даже миллионов точек. Это значительно превышает максимальное допустимое число точек для~большинства
    алгоритмов \cite{mueller-stable, mueller-meshless, chang-crash} при расчётах в~реальном времени на
    современных настольных компьютерах и компьютерах, используемых в тренажёрах. Из-за этого
    невозможно использовать одно и~то~же представление объекта и для моделирования, и для
    отображения.

  \section{Описание предметной области}\label{domain}

    Существуют различные подходы к~моделированию деформаций в~реальном времени. В простейшем случае
    ограничения на~быстродействие алгоритма обходятся за счёт использования предварительно рассчитанных
    деформированных состояний для~некоторого конечного набора возможных ударов по~объекту, одно из которых
    (или~интерполяция между несколькими ближайшими) выбирается в~зависимости от~того, к~какому
    из~этих ударов ближе всего произошедший. В~этом случае допускается использование достаточно сложных
    для~вычисления алгоритмов, таких~как система масс и~пружин (англ. {\English mass-spring system})
    с~большим разрешением или~метод конечных элементов (англ. {\English finite elements method, FEM}).
    Однако, при ударе, отличающемся от~заранее рассчитанного, или в~случае сложной комбинации ударов
    моделируемые деформации будут выглядеть не реалистично \cite[с.~1064]{chang-crash}. Кроме того, значительное время, требуемое
    для предварительных расчётов после каждого изменения объекта, прежде чем он может быть загружен
    в приложение для тестирования, создаёт неудобства при разработке приложения. Поэтому наибольший
    интерес представляют решения, в которых моделирование деформаций происходит во время исполнения.

    Одной из~простейших моделей деформируемого тела является упоминавшаяся выше система масс
    и~пружин, в~которой тело представляется в~виде пространственной (как~правило, регулярной и
    кубической) решётки из~материальных точек, связанных между~собой пружинами, при~изменении длины
    прикладывающими к~своим концам силу согласно закону Гука. Будучи очень простой в~реализации,
    такая модель, тем не менее, имеет определённые недостатки. Она моделирует поведение объекта не
    очень точно, причём оно сильно зависит от формы решётки и расположения пружин в ней \cite[с.~8]{mueller-physmodels}.
    Другим недостатком является то, что возбуждение, приложенное локально, распространяется по
    объекту постепенно, перемещаясь на один шаг решётки за шаг алгоритма \cite[с.~232]{parent-animation}.
    Кроме~того, требуется выполнять дополнительную работу по конвертации представления объекта,
    используемого для его отображения (чаще всего это сетка из треугольников), в~регулярную решётку
    и~подбору значений коэффициента упругости пружин так, чтобы добиться требуемых свойств
    моделируемого материала.

    Принципиально другой подход реализуется в моделях, использующих метод конечных элементов, широко
    используемый в~инженерных расчётах. При таком подходе
    непрерывные характеристики деформируемого тела вычисляются путём интерполяции их~значений
    на~элементах конечного размера. Разумеется, использовать в чистом виде этот метод
    в приложениях реального времени невозможно, поскольку инженерные расчёты производятся в
    течение нескольких часов и даже суток. Однако, существуют модели, предлагающие различные упрощения этих
    методов, которые допускают вычисление в реальном времени, как, например в \cite{mueller-stable}.
    Деформации при этом моделируются намного точнее, чем в случае системы масс и пружин, но даже
    упрощённый алгоритм требует больше времени для вычислений.

    Отдельно стоят так~называемые геометрические алгоритмы, в~которых напрямую не~моделируются
    физические законы. Как~правило, объект представляется в~виде системы частиц, движение каждой из
    которых сначала интегрируется независимо от~остальных, а~следующим шагом на объект в~целом
    накладываются различные физически мотивированные ограничения (сохранение формы, объёма, импульса
    и~т.п.), обеспечивающие в итоге правдоподобные деформации. Такие методы обладают хорошим
    быстродействием и могут вычисляться параллельно, при этом обладая большей устойчивостью и
    простотой в конфигурации, чем системы масс и пружин. Пример такого метода описывается в \cite{mueller-meshless}.

  \section{Постановка задачи}

    Целью работы является разработка системы моделирования деформаций объектов для применения в
    приложениях виртуальной реальности: в компьютерных играх и обучающих тренажёрах.
    К~системе предъявляются следующие требования.

    Необходимо использовать сетки из треугольников в качестве внутреннего представления, либо
    предоставить возможность конвертации, поскольку в приложениях виртуальной реальности отображаемые объекты
    чаще всего представляются именно в таком формате.

    Система должна иметь достаточное быстродействие, чтобы обеспечивать моделирование в~реальном
    времени. Чтобы это было возможно даже для~объектов, заданных сеткой с~большим числом вершин,
    должна иметься возможность использовать при~моделировании менее детализированное представление
    объекта, а~отображаемую сетку более высокого разрешения обновлять так, чтобы она повторяла
    рассчитанные деформации. При~этом важно предусмотреть некоторое сглаживание смещений точек
    отображаемого объекта, иначе в~их~движении можно будет проследить форму низко детализированного
    представления.

    Кроме~того, предварительно рассчитанные деформированные состояния не~должны использоваться,
    поскольку, как было объяснено в разделе~\ref{domain}, такой подход негативно сказывается на реалистичности
    моделирования и создаёт неудобства при разработке приложения.

    Наконец, интерфейс, предоставляемый системой, не~должен создавать трудностей при~интеграции
    системы в~приложения виртуальной реальности. Основные критерии, которым необходимо следовать,
    описаны в~\cite{gems-middleware} и~включают, в~частности, конфигурируемые обработку ошибок,
    логирование и~выделение памяти, а также отказ от~прямого доступа к~файловой системе в~пользу
    работы с~буферами в~оперативной памяти.

    Для достижения цели необходимо решить следующие задачи.
    \begin{enumerate}
      \item Разработать и~реализовать алгоритм моделирования в реальном времени деформаций
        не\-у\-пру\-гих тел, содержащих недеформируемые части;
      \item Предоставить интерфейс для~двустороннего взаимодействия с~приложением, в~которое будет
        встроена система, включающий:
        \begin{enumerate}
          \item конвертацию представления объекта, используемого в приложении, во внутреннее представление;
          \item получение извне информации о~столкновениях объекта и~приложенных к~нему силах;
          \item сообщение наружу о сильных локальных деформациях;
          \item обновление отображаемой сетки.
        \end{enumerate}
      \item Предусмотреть в~алгоритме возможность использования параллельных вычислений.
    \end{enumerate}

  \section{Предлагаемое решение}
    \subsection{Ограничения}

      Требование быстродействия и переносимости накладывает некоторые ог\-ра\-ни\-че\-ния на реализацию системы.
      \begin{enumerate}
        \item Должна быть написана на~языке C++.
        \item Использование нестандартных библиотек и~STL не~допускается.
        \item Во~время основного цикла исполнения не~должно происходить динамического выделения памяти.
        \item При~синхронизации параллельно исполняемых участков кода в основном цикле нужно
          избегать использования блокирующих примитивов синхронизации.
      \end{enumerate}

    \subsection{Архитектура системы}

      Система реализуется в~виде модуля, который может быть встроен в~приложение виртуальной
      реальности: статической либо динамической библиотеки. В~ней выделяются следующие подсистемы.
      \begin{enumerate}
        \item Ядро системы, обеспечивающее собственно моделирование.
        \item Подсистема математики.
        \item Подсистема логирования и~обработки ошибок.
        \item Набор необходимых контейнеров.
      \end{enumerate}

      \subsubsection{Ядро системы}
        
        Ядро системы реализует класс "деформируемый физический объект". Он инициализируется
        начальной конфигурацией объекта и~предоставляет интерфейс для совершения с~ним следующих действий.
        \begin{enumerate}
          \item Задание приложенных сил и~произошедших столкновений.
          \item Определение реакции на~определённые события, происходящие при~деформации объекта:
            \begin{enumerate}
              \item удар в~заданною область, превышающий по~силе заданный порог;
              \item отклонение некоторой точки объекта от~начальной позиции больше заданного предела;
              \item вход некоторой точки в~заданную область (или выход из~неё).
            \end{enumerate}
          \item Моделирования процесса деформаций для~заданного промежутка времени.
          \item Обновление формы отображаемой сетки.
        \end{enumerate}

        Таким образом, для~обеспечения перечисленной функциональности система также реализует следующие классы.
        \begin{enumerate}
          \item Сила, приложенная к~объекту.
          \item Реакция на событие (абстрактный класс, наследуясь от~которого, пользователь системы
            может определить необходимое ему поведение).
          \item Область в~трёхмерном пространстве.
          \item Описатель формата отображаемой сетки.
        \end{enumerate}

      \subsubsection{Подсистема математики}

        Подсистема математики реализует необходимые для~расчёта деформаций математические объекты
        и~функции.

      \subsubsection{Подсистема логирования и~обработки ошибок}

        Данная подсистема обеспечивает обработку ошибок и~предупреждений, возникающих в~процессе
        работы системы, а~также логирование, позволяя пользователю системы переопределить действия,
        выполняемые в ответ на каждое из этих событий.

    \subsection{Основной алгоритм}

      \todo{обосновать выбор.}
      
      \todo{насколько подробно надо пересказывать их алгоритм, нужны~ли формулы?}

      В основу алгоритма моделирования взят алгоритм, описанный в~\cite{mueller-meshless}. Объект
      представляется в~виде набора вершин, сгруппированных в~перекрывающиеся кластеры (информация
      о~связях между вершинами, то~есть об~образуемых ими полигонах, не требуется). Над каждым
      кластером производится операция сопоставления формы: вычисляется смещение центра масс кластера
      $\Delta \vect{x}_{c.m.}$ (\todo{кириллица в формуле}) и оптимальное линейное преобразование
      $\matrx A$, действие которого переводит исходную форму кластера в~наиболее близкую к~текущей
      форме. Позиции вершин в кластере, подвергнутые оптимальному линейному преобразованию и
      смещению центра масс $\vect{g}_i = \matrx{\todo{?}} \vect{x}_i + \Delta \vect{x}_{c.m.}$,
      называются целевыми позициями. Для каждой вершины, исходя из величины отклонения текущей
      позиции от~целевой, рассчитывается поправка к~скорости, корректирующая это отклонение. Если
      вершина входит одновременно в~несколько кластеров, то~есть находится в~зоне их перекрытия,
      корректирующие поправки от~каждого из~кластеров усредняются, что обеспечивает целостность
      объекта: за~счёт этого кластеры, обрабатываемые независимо, не~отделяются друг от~друга. Для
      моделирования неупругости остаточная деформация каждого кластера сохраняется в~форме линейного
      преобразования, то~есть матрицы $3 \times 3$. Изначально она единичная, а~изменение
      происходит, лишь когда мера текущей деформации превышает заданную пороговую величину. В~качестве
      такой меры может быть использована $ ||\matrx S - \matrx E||_2 $, где $\matrx S$~---
      симметричная компонента $\matrx A$ (получаемая при полярном разложении $\matrx A = \matrx R
      \matrx S$), $\matrx E$~--- единичная матрица, а в~качестве нормы второго порядка может быть
      взята норма Фробениуса. \todo{ой~ли? А~формулка?}

      В~исходный алгоритм вносятся некоторые изменения, адаптирующими алгоритм к~условиям данной
      задачи. В~частности, моделирование неупругих тел требует демпфирования возникающих колебаний,
      для чего используется способ, описанный в~\cite[с.~5]{mueller-position-dynamics}. Сначала выделяется
      движение тела как~целого~--- вычисляются скорость центра масс $\vect{v}_{c.m.}$ и угловая
      скорость $\vect{\omega}$, с~учётом предварительно рассчитанных характеристик тела: центра масс
      $\vect{x}_{c.m.}$ и тензора инерции $\matrx I$. Затем для каждой вершины вычисляется скорость,
      которую она имела~бы, если~бы тело было абсолютно твёрдым:
      \begin{equation}\label{eq:rigid_velocity}
        \vect{u}_i = v_{c.m.} + \omega \times (\vect{x}_i - \vect{x}_{c.m.}).
      \end{equation}
      Демпфированию подвергается только индивидуальное отклонение скорости вершины
      $\Delta \vect{v}_i = \vect{u}_i - \vect{v}_i$, за счёт чего $\vect{v}_{c.m.}$ и $\vect{\omega}$
      сохраняются.

      Кроме того, система отвечает только за~моделирование деформаций, а глобальное движение и
      определение столкновений рассчитываются отдельно приложением, в~которое встроена система.
      Поэтому расчёт деформаций необходимо производить в~локальных координатах~--- в~системе отсчёта
      центра масс объекта. При~этом важно учесть, что вследствие удара или воздействия внешних сил
      у~тела может появиться как ненулевая скорость центра масс, так и ненулевая угловая скорость.
      Таким образом, система отсчёта, в~которой производится расчёт, перестанет быть системой центра
      масс.  Поэтому после интегрирования скоростей и до интегрирования позиций вершин производится
      коррекция. Приобретённые на данном шаге $\vect{v}_{c.m.}$ и $\vect{\omega}$ уже получены
      в~ходе расчёта демпфирования, они сообщаются наружу для прибавления к соответствующим
      глобальным скоростям. Чтобы локальная система отсчёта снова стала системой центра масс,
      необходимо скомпенсировать приобретённые $\vect{v}_{c.m.}$ и $\vect{\omega}$, вычитая из
      скорости каждой вершины $\vect{u}_i$ из \eqref{eq:rigid_velocity}.

    \subsection{Реализация дополнительных функций}
    \subsubsection{Недеформируемые части объекта}
    \subsubsection{Реакции на деформации}
    \subsubsection{Поддержка высокополигональных сеток}
    \subsection{Параллельные вычисления}

  \section{План-график}

    \begin{center}
      \begin{tabular}{|p{10.3cm}|c|c|}\hline
        Задача                                       & Время         & Срок  \\\hline\hline
        Проработка архитектуры системы, разработка и реализация алгоритма деформаций
        с юнит-тестами для тестирования базовых функций и простым тестовым приложением
        для комплексного тестирования                & (выполнено)   & 31.10 \\\hline
        Реализация интерфейса {\English callback}'ов & (выполнено)   & 15.12 \\\hline
        Реализация отображения низкополигональной
        модели на высокополигональную сетку          & (выполнено)   & 15.01 \\\hline
        Разработка интерактивного приложения для
        тестирования правдоподобности деформаций     & (выполнено)   & 15.01 \\\hline
        Профилирование и оптимизация алгоритма       & 1,5 мес.      & 28.02 \\\hline
        Адаптация алгоритма для параллельных
        вычислений                                   & 1 мес.        & 31.03 \\\hline
      \end{tabular}
    \end{center}

  \section{Оценки за отчёт}

    Руководитель: \underscore{1cm} (из 10). Подпись: \underscore{3cm} (Д.\,А.\,Гладкий)

    \vspace{0.5cm}
    Преподаватель: \underscore{2cm}

  \clearpage % TODO is this good?
  \addcontentsline{toc}{section}{Список литературы}
  \bibliography{../biblio/my}
\end{document}

